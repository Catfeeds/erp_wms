<div class="container-fluid"> 
  <!-- BEGIN PAGE HEADER-->
  <div class="row-fluid">
    <div class="span12"> 
      <!-- BEGIN PAGE TITLE & BREADCRUMB-->
      <h3 class="page-title"> <small> </small> </h3>
      <ul class="breadcrumb">
        <li> <i class="icon-home"></i> <a>供货订阅管理</a> <span class="icon-angle-right"></span> </li>
        <li> <a href="#">供应商管理</a> <span class="icon-angle-right"></span> </li>
        <li><a href="#">供应商品列表</a></li>
      </ul>
      <!-- END PAGE TITLE & BREADCRUMB--> 
    </div>
  </div>
  <!-- END PAGE HEADER--> 
  <!-- BEGIN PAGE CONTENT-->
  <div class="row-fluid">
    <div class="span12">
      <div class="portlet box blue">
        <div class="portlet-title">
          <div class="caption"><i class="icon-search"></i>供应商品搜素</div>
          <div class="tools"> <a href="javascript:;" class="collapse"></a> </div>
        </div>
        <div class="portlet-body" style="display: block;">
          <div id="sample_1_wrapper" class="dataTables_wrapper form-inline" role="grid">
            <form action="" method="get" onsubmit="return load_sub();">
              <div class="row-fluid">
                <span class="span1" style="display:block;">
                <div id="span_label">每页显示</div>
                </span>
                <div class="span3" style="margin-left:0px;">
                  <select size="1" name="search_page_num" aria-controls="sample_1" class="form_2_select2 m-wrap span5">
                    <option <{if $smarty.get.search_page_num=='all'}>selected="selected"<{/if}> value="all">每页显示</option>
                    <option <{if $smarty.get.search_page_num=='1'}>selected="selected"<{/if}> value="1">15</option>
                    <option <{if $smarty.get.search_page_num=='2'}>selected="selected"<{/if}> value="2">30</option>
                    <option <{if $smarty.get.search_page_num=='3'}>selected="selected"<{/if}> value="3">50</option>
                  </select>
                </div>                            
                
                <span class="span1" style="display:block;">
                <div id="span_label">商品名称</div>
                </span>
                <div class="span3" style="margin-left:0px;">
                  <input type="text" class="m-wrap small" name="search_name" value="<{$smarty.get.search_name}>" />
                </div>    
              </div>
              
              <div class="row-fluid" style="margin-top:20px;">       
                <span class="span1" style="display:block;">
                <div id="span_label">产品状态</div>
                </span>
                <div class="span3" style="margin-left:0px;">
                   <select size="1" name="search_status" aria-controls="sample_1" class="form_2_select2 m-wrap span5">
                    <option <{if $smarty.get.search_status=='all'}>selected="selected"<{/if}> value="all">全部状态</option>
                    <option <{if $smarty.get.search_status==='0'}>selected="selected"<{/if}> value="0">下架</option>
                    <option <{if $smarty.get.search_status=='1'}>selected="selected"<{/if}> value="1">上架</option>
                  </select>
                </div>

                <span class="span1" style="display:block;">
                <div id="span_label">对接编码</div>
                </span>
               <div class="span3" style="margin-left:0px;">
                  <input type="text" class="m-wrap small" name="search_id" value="<{$smarty.get.search_id}>" />
                </div>
              </div>
              
              <div class="row-fluid" style="margin-top:20px;">       
                <span class="span1" style="display:block;">
                <div id="span_label">供应商UID</div>
                </span>
                <div class="span3" style="margin-left:0px;">
                  <input class="m-wrap small" type="text" name="search_userid" value="<{$smarty.get.search_userid}>">
                </div>

                <span class="span1" style="display:block;">
                <div id="span_label">平台编号</div>
                </span>
                <div class="span2" style="margin-left:0px;">
                  <div class="input-append"> 
                    <input type="text" class="m-wrap small" name="search_id" value="<{$smarty.get.search_id}>" />
                    <button class="btn green" type="submit">Search</button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div>
        <div>
          <div id='product_all'>
              <table class="table table-striped table-bordered table-hover dataTable" id="product_1" >
                <thead>
                  <tr role="heading">
                    <th width="20" class="sorting_disabled"  width="20" ><input value="0" type="checkbox" class="group-checkable list-checkable"  data-set='#product_all .list-checkable' /></th>
                    <th width="50" class="sorting_disabled" role="columnheader" tabindex="0" aria-controls="sample_1">操作</th>
                    <th width="60"  class="sorting_disabled" role="columnheader" tabindex="0" aria-controls="sample_1">上架状态</th>
                    <th width="70"  class="sorting_disabled" role="columnheader" tabindex="0" aria-controls="sample_1">平台编号</th>
                    <th width="80"  class="sorting_disabled" role="columnheader" tabindex="0" aria-controls="sample_1">供应商UID</th>
                    <th width="*" class="sorting_disabled" role="columnheader" tabindex="0" aria-controls="sample_1">商品名称</th>
                    <th width="90"  class="sorting_disabled" role="columnheader" tabindex="0" aria-controls="sample_1">库存</th>
                    <th width="90"  class="sorting_disabled" role="columnheader" tabindex="0" aria-controls="sample_1">已订购库存</th>
                    <th width="80"  class="sorting_disabled" role="columnheader" tabindex="0" aria-controls="sample_1">供应价</th>
                  </tr>
                </thead>
                <tbody role="alert" aria-live="polite" aria-relevant="all">
                <{if $re}>
                  <{foreach item = item from = $re.list}>
                    <tr> 
                      <td><input type="checkbox" name="item[]"  value="<{$item.id}>" class="list-checkable" /></td>
                      <td>
                      <a href="javascript:;" onclick="alertWin('审查',800,400,'<{"spuser/spuser_product_check"|site_url}>/?id=<{$item.id}>')" class="btn mini green">审查</a>
                      </td>
                      <td>
                        <{if $item.status==1}>
                          <span  class="label label-info">上架</span>
                        <{else}>
                          <span class="label label-important">下架</span>
                        <{/if}>
                      </td>                
                      <td><{if $item.stock_id}><{$item.stock_id}><{else}>未入订阅库<{/if}></td>
                      <td><{$item.userid}></td>    
                      <td><{$item.name}></td>      
                      <td><{$item.c_num}></td>
                      <td><{$item.online_num}></td>                
                      <td><{$item.price}></td>
                    </tr>
                  <{/foreach}>
                <{else}>
                  <tr>
                    <td colspan="99">暂时无数据</td>
                  </tr>
                <{/if}>
              </table>
              <div class="row-fluid">
                <div class="span6" id='sub_submit'>
                  <input type="checkbox"  value="0" class="group-checkable list-checkable" data-set="#product_all .list-checkable">
                  <input type="button" class="btn green df_sub" data-type="1" value="加入订阅库">
                </div>
                <div class="clear"></div>
                <div class="span6">
                  <div class="dataTables_paginate paging_bootstrap pagination"> <{$re.page}> </div>
                </div>
              </div>
          </div>
          <!--show window--> 
        </div>
      </div>
    </div>
  </div>
  <!-- END PAGE CONTENT--> 
</div>
<link href="/static/css/jquery.fancybox.css" rel="stylesheet">
<script src="/static/js/jquery.fancybox.pack.js"></script> 
<script>
$('.form_2_select2').select2({
            placeholder: "请选择",
            allowClear: true
});
$('#sub_submit .df_sub').each(function(index, element) {
     var type=$(this).attr('data-type');
	
});

var bind_window=function()
{
   App.initFancybox();
  $.fn.modalmanager.defaults.resize = true;
  $.fn.modalmanager.defaults.spinner = '<div class="loading-spinner fade" style="width: 200px; margin-left: -100px;"><img src="/static/ajax-modal-loading.gif" align="middle">&nbsp;<span style="font-weight:300; color: #eee; font-size: 18px; font-family:Open Sans;">&nbsp;Loading...</div>';
  var $modal = $('#ajax-modal');
  $('#sub_submit .df_sub').each(function(index, element) {
      var  select_id=$(this).attr('data-type');
	  if(select_id==1)
	  	var  url='<{"spuser/spuser_product_check_list"|site_url}>'; //批量加入订阅库
	  else if(select_id==2)
	    var  url='<{"spuser/spuser_product_open"|site_url}>'; //上架	
	  else if(select_id==3)
	    var  url='<{"spuser/spuser_product_close"|site_url}>'; //下架		      

      $(this).on('click', function(){
		$.fn.modal.defaults.width='1600px';
	    $.fn.modal.defaults.height='600px';
		var ids='0';
		$('#product_all .list-checkable').each(function(index, element) {
			  if($(this).attr('checked')&&$(this).val()!=0)
				  ids+=','+$(this).val();
		});   
        // create the backdrop and wait for next modal to be triggered
        $('body').modalmanager('loading');
        setTimeout(function(){
         $modal.load(url+"?ids="+ids,'', function(){
          $modal.modal();
          //$modal.css('margin-top','0');
         });
        }, 100);
    });
  });
}
//row-details row-details-close
var initTable= function() {
        /* Formating function for row details */
      
        /*
         * Insert a 'details' column to the table
         */
		$('#product_1').dataTable( {
           "aoColumnDefs": [
               {"bSortable": false, "aTargets": [ 0 ] }
            ],
            "aaSorting": [[1, 'asc']],
            "aLengthMenu": [
               [5, 15, 20, -1],
                [5, 15, 20, "All"] // change per page values here
           ],
		    "oLanguage": {
					"sProcessing": "正在加载中......",
					"sLengthMenu": "每页显示 _MENU_ 条记录",
					"sZeroRecords": "正在加载中......",
					"sEmptyTable": "查询无数据！",
					"sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录",
					"sInfoEmpty": "显示0到0条记录",
					"sInfoFiltered": "数据表中共为 _MAX_ 条记录",
					"sSearch": "当前页数据搜索",
					"oPaginate": {
					 "sFirst": "首页",
					 "sPrevious": "上一页",
					 "sNext": "下一页",
					 "sLast": "末页"
					}
  			},
			"bSort":false,
			"bInfo":false,
			"bPaginate":false,
			"bAutoWidth":true,
			"bStateSave":false,
			"sScrollX":'1690px',
			//"sScrollY":"300px",
            // set the initial value
            //"iDisplayLength": 10,
			//'sScrollXInner':true,
			//"bSortCellsTop":true,
        });
        
      
    }


function load_ini()
{
	bind_window(); 
	/* <{if $re}> */
	initTable();
	/* <{/if}> */

	jQuery('.group-checkable').change(function () {
	  var set = jQuery(this).attr("data-set");
	  
	  var checked = jQuery(this).is(":checked");
	  
	  jQuery(set).each(function () {
		  if (checked) {
			  $(this).attr("checked", true);
		  } else {
			  $(this).attr("checked", false);
		  }
	  });
	  jQuery.uniform.update(set);
	});

	
}

</script> 